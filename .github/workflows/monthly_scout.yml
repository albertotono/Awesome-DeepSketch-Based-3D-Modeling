name: ðŸ¦ž Monthly Free Scout (No Keys)

on:
  schedule:
    - cron: '0 0 1 * *' # 1st of every month
  workflow_dispatch:

jobs:
  agent-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4

      # --- STEP 1: Install Ollama (The Free Brain) ---
      - name: Install & Start Ollama
        run: |
          curl -fsSL https://ollama.com/install.sh | sh
          ollama serve & 
          echo "Waiting for Ollama to wake up..."
          sleep 5
          
      # --- STEP 2: Download Model ---
      - name: Pull Llama 3.2 (Small & Fast)
        run: ollama pull llama3.2

      # --- STEP 3: Setup Python ---
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Tools
        run: pip install -r requirements.txt

      # --- STEP 4: Run Agent ---
      - name: Run The Scout
        run: python scout_agent.py

      # --- STEP 5: Create PR ---
      - name: Check Results
        id: check_files
        run: |
          if [ -f new_papers_free.md ]; then
            echo "has_papers=true" >> $GITHUB_OUTPUT
          fi

      - name: Create Pull Request
        if: steps.check_files.outputs.has_papers == 'true'
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "ðŸ¦ž Agent found new papers (Free Mode)"
          body: |
            This run used **DuckDuckGo** and **Llama 3.2** (running locally).
            
            Results:
            $(cat new_papers_free.md)
          branch: "agent/free-update"
